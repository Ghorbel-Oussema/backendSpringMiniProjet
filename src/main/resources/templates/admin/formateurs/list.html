<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="admin/layout :: layout (~{::body})">
<body>
<div>

<h2>Liste des formateurs</h2>
<!--  
<a class="btn btn-primary mb-3" th:href="@{/admin/formateurs/new}">
    Ajouter un formateur
</a>-->

<!-- Recherche -->
<form class="row mb-3">
    <div class="col-md-4">
        <input class="form-control"
               name="keyword"
               th:value="${keyword}"
               placeholder="Rechercher par nom...">
    </div>
    <div class="col-md-2">
        <button class="btn btn-primary">Rechercher</button>
    </div>
</form>

<!-- TABLE -->
<table class="table table-striped">
<thead>
<tr>
    <th>Nom</th>
    <th>Spécialité</th>
    <th>Action</th>
</tr>
</thead>

<tbody>
<tr th:each="f : ${formateurs.content}">
    <td th:text="${f.nom}"></td>
<td th:text="${f.specialite != null ? f.specialite.nom : '—'}"></td>

    <td>
        <button class="btn btn-info btn-sm view-btn"
                th:attr="data-id=${f.id}">
            Voir
        </button>

        <button class="btn btn-warning btn-sm edit-btn"
                th:attr="data-id=${f.id}">
            Modifier
        </button>

        <a class="btn btn-danger btn-sm"
           th:href="@{/admin/formateurs/delete/{id}(id=${f.id})}">
            Supprimer
        </a>
    </td>
</tr>
</tbody>
</table>

<!-- PAGINATION -->
<nav>
<ul class="pagination">

<li class="page-item" th:classappend="${formateurs.first} ? 'disabled'">
    <a class="page-link"
       th:href="@{/admin/formateurs(page=${formateurs.number-1}, keyword=${keyword})}">
        Précédent
    </a>
</li>

<li class="page-item"
    th:each="i : ${#numbers.sequence(0, formateurs.totalPages-1)}"
    th:classappend="${i == formateurs.number} ? 'active'">
    <a class="page-link"
       th:text="${i+1}"
       th:href="@{/admin/formateurs(page=${i}, keyword=${keyword})}">
    </a>
</li>

<li class="page-item" th:classappend="${formateurs.last} ? 'disabled'">
    <a class="page-link"
       th:href="@{/admin/formateurs(page=${formateurs.number+1}, keyword=${keyword})}">
        Suivant
    </a>
</li>

</ul>
</nav>

<!-- ================= MODAL EDIT ================= -->
<div class="modal fade" id="editModal">
<div class="modal-dialog">
<form method="post" th:action="@{/admin/formateurs/update}">
<div class="modal-content">

<div class="modal-header">
    <h5>Modifier Formateur</h5>
    <button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">
    <input type="hidden" name="id" id="fid">

    <label class="form-label">Nom</label>
    <input class="form-control"
           name="nom"
           id="fnom">
     <label class="form-label">Spécialité</label>
<select class="form-select" name="specialite.id" id="fspecialite">
    <option value="">—</option>
    <option th:each="s : ${specialites}"
            th:value="${s.id}"
            th:text="${s.nom}">
    </option>
</select>

     
</div>

<div class="modal-footer">
    <button class="btn btn-primary">Enregistrer</button>
</div>

</div>
</form>
</div>
</div>

<!-- ================= MODAL VIEW ================= -->
<div class="modal fade" id="viewModal">
<div class="modal-dialog">
<div class="modal-content">

<div class="modal-header">
    <h5>Détails Formateur</h5>
    <button class="btn-close" data-bs-dismiss="modal"></button>
</div>

<div class="modal-body">
    <p><strong>Nom :</strong> <span id="v_nom"></span></p>
    <p><strong>Spécialité :</strong> <span id="v_specialite"></span></p>
</div>

</div>
</div>
</div>

</div>

<!-- ================= JS ================= -->
<script>
document.addEventListener("DOMContentLoaded", () => {

document.querySelectorAll(".edit-btn").forEach(btn => {
    btn.onclick = () => {
        fetch("/admin/formateurs/edit/" + btn.dataset.id)
            .then(r => r.json())
            .then(f => {
                fid.value = f.id;
                fnom.value = f.nom;
                fspecialite.value = f.specialiteId ?? '';
                new bootstrap.Modal(editModal).show();
            });
    };
});

document.querySelectorAll(".view-btn").forEach(btn => {
    btn.onclick = () => {
        fetch("/admin/formateurs/edit/" + btn.dataset.id)
            .then(r => r.json())
            .then(f => {
                v_nom.textContent = f.nom;
                v_specialite.textContent = f.specialiteNom ?? '—';

                new bootstrap.Modal(viewModal).show();
            });
    };
});

});
</script>

</body>
</html>
